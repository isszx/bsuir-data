# Управление памятью

10-15 лет назад проблемы с памятью была острой, и был разработан механизм виртуальной памяти.

Функции ОС(Операционная система) по управлению памятью является:
- отслеживание свободной и занятой памяти
- выделение памяти процессам / освобождение памяти процессов
- вытеснение кодов и данных процессов из ОП(Оперативная память) на диск (полное или частичное)

Когда размера основной памяти недостаточно для размещения в ней всех процессов и возвращения из в оперативную память, когда в ней освобождается место.
Настройка адресов программ на конкретную область физической памяти.
Защита памяти (не позволяет одному процессу читать память другого)
Виртуализация памяти может быть реализована на основе 2-х походов **swapping** образы процессов выгружается на диск и возвращается в ОП целиком.
Виртуальная память - между ОП и диском перемещает части процессов (сегменты, страницы).
Недостаток swappinga - при подкачке образов процессов для его выполнения, не требуется загружать в ОП все его сегменты полностью.
По этому пришел механизм виртуальной памяти, в настоящее время виртуальная память может быть представлена 3-мя видами:
- страничная - перемещение данных между памятью и диском реализовано страницами фиксированного размера
- сегментная - перемещение данных между памятью и диском реализовано сегментами
- сегментно-страничная - использует 2-х уровневое разделение: виртуально адресное пространство(далее **ВАП**) делится на сегменты, а сегменты делятся на страницы, единица перемещения **страница**

Для временного хранения страниц, сегментов на диске отведена специальная область или файл.
Страничная организация памяти до 18...

![Рисунок 1](/ОСиСП/Установка/img/img1.png)

При страничной организации памяти ВАП процесса делится на страницы, ОП также делится на страницы, таким образом решили проблему фрагментированния памяти.
При создании процесса ОС загружает в ОП несколько его страниц.
Смежные виртуальные страницы не должны обязательно располагаться в смежных физических страницах для каждого процесса ОС создает таблицу страниц которая содержит записи о всех виртуальных страницах процесса.

Запись таблицы она же (дескриптор страницы) вкл следующую информацию.

1. номер физической страницы в которую загружены данные виртуальной страницы;
2. признак(бит) присутствия = 1 если виртуальная страница находится в ОП
3. признак(бит) модификации = 1 если производится запись по адресу данной страницы;
4. признак(бит доступа) обращения = 1 при каждом обращении к странице

Инфа. из страниц используется для преобразования виртуального адреса в физический, а также для решения вопроса по перемещению страниц.

При каждом обращении к памяти выполняется поиск нужной виртуальной страницы, затем по этому номеру определятся элемент в таблице страниц, и описывающая эту страницу информация.

Далее анализируется признак присутствия, и если данная страница находится в ОП то выполняется преобразование виртуальногоадреса в физический.

Виртуальные адреса(мнимые адреса) - которые вырабатывает транслятор при переводе программы на машинный язык.
Физические адреса() - соответствуют ячейкам ОП где в действительности расположены данные.

Если же нужная виртуальная страница выраженна на диск, то происходит __страничное прерывание__. Выполняющийся(активный) процесс переводится в состояние ожидание, активизируется другой процесс из очереди готовых на его место.
Параллельно программа обработки страничного прерывания, находит на диске нужную страницу, и пытается загрузить ее в ОП.
Если в памяти имеется свободная физическая страница, то загрузка выполняется сразу.
Если же места нет, то решается вопрос о том какую страницу выгрузить из ОП. Для этого анализируются признаки.

Виртуальный адрес при страничном распределении памяти в виде пары (P, S)
> P - номер виртуальной страницы процесса
> S - смещение внутри страницы

> Виртуальная память = ОП + физическая память

![Рисунок 2](/ОСиСП/Установка/img/img2.png)

Из специального регистра процессора CR0 извлекается (AT) адрес таблицы страниц процесса.
На основании первоначального адреса, определяется номер страницы, номер виртуальной страницы (P) а так же, длинны записи (L) определяется соответствующий физический адрес страницы (n).
К номеру физической страницы присоединяется смещение (S).

Посмотреть дома книги:

- Современные операционные системы, Эндрю Таненбаум
- Системное программирование, Побегайло А. П.
- Сетевые операционные системы, Олифер

Сегменты организации распределения.
В программе выделяются определенные сегменты.
CS - сегмент входа. (создает система)
DS - сегмент данных. (управляется программистом)
SS - сегмент стека. (управляется программно)
ES, FS, JS - играю роль дополнительных сегментов (исп. как сегменты памяти)
